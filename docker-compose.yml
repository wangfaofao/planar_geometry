# Docker Compose for development and testing

version: '3.8'

services:
  # Development container
  dev:
    build:
      context: .
      dockerfile: Dockerfile
    image: planar_geometry:dev
    container_name: planar_geometry_dev
    volumes:
      - .:/app/project
    working_dir: /app/project
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      PYTHONUNBUFFERED: 1

  # Testing container (Python 3.10)
  test-py310:
    image: python:3.10-slim
    container_name: planar_geometry_test_py310
    working_dir: /app
    volumes:
      - .:/app
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      PYTHONUNBUFFERED: 1
    command: |
      bash -c "
      pip install -e . &&
      pip install -r requirements-test.txt &&
      pytest tests/ -v --cov=src/planar_geometry
      "

  # Testing container (Python 3.11)
  test-py311:
    image: python:3.11-slim
    container_name: planar_geometry_test_py311
    working_dir: /app
    volumes:
      - .:/app
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      PYTHONUNBUFFERED: 1
    command: |
      bash -c "
      pip install -e . &&
      pip install -r requirements-test.txt &&
      pytest tests/ -v --cov=src/planar_geometry
      "

  # Testing container (Python 3.12)
  test-py312:
    image: python:3.12-slim
    container_name: planar_geometry_test_py312
    working_dir: /app
    volumes:
      - .:/app
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      PYTHONUNBUFFERED: 1
    command: |
      bash -c "
      pip install -e . &&
      pip install -r requirements-test.txt &&
      pytest tests/ -v --cov=src/planar_geometry
      "

  # Testing container (Python 3.13)
  test-py313:
    image: python:3.13-slim
    container_name: planar_geometry_test_py313
    working_dir: /app
    volumes:
      - .:/app
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      PYTHONUNBUFFERED: 1
    command: |
      bash -c "
      pip install -e . &&
      pip install -r requirements-test.txt &&
      pytest tests/ -v --cov=src/planar_geometry
      "

  # Documentation builder
  docs:
    image: python:3.11-slim
    container_name: planar_geometry_docs
    working_dir: /app
    volumes:
      - .:/app
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      PYTHONUNBUFFERED: 1
    command: |
      bash -c "
      pip install -r requirements-docs.txt &&
      cd docs &&
      sphinx-build -b html . _build/html
      "
