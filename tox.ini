[tox]
envlist = py310,py311,py312,py313,lint,type,docs
skip_missing_interpreters = true
minversion = 4.0

[testenv]
description = Run unit tests with pytest
deps =
    -r{toxinidir}/requirements-test.txt
commands =
    pytest {posargs:tests/} -v --cov=src/planar_geometry --cov-report=term-missing --cov-report=html

[testenv:lint]
description = Run linting checks
deps =
    -r{toxinidir}/requirements-dev.txt
commands =
    black --check src/ tests/
    ruff check src/ tests/
    isort --check-only src/ tests/

[testenv:format]
description = Auto-format code
deps =
    -r{toxinidir}/requirements-dev.txt
commands =
    black src/ tests/
    isort src/ tests/
    ruff check --fix src/ tests/

[testenv:type]
description = Run type checking
deps =
    -r{toxinidir}/requirements-dev.txt
commands =
    mypy src/planar_geometry --strict
    pyright src/planar_geometry

[testenv:coverage]
description = Run tests with coverage report
deps =
    -r{toxinidir}/requirements-test.txt
commands =
    pytest tests/ -v --cov=src/planar_geometry --cov-report=term-missing --cov-report=html --cov-report=xml
    coverage report --fail-under=80

[testenv:docs]
description = Generate Sphinx documentation
deps =
    -r{toxinidir}/requirements-docs.txt
commands =
    sphinx-build -W -b html -d {envtmpdir}/doctrees docs docs/_build/html

[testenv:dev]
description = Development environment
usedevelop = true
deps =
    -r{toxinidir}/requirements-dev.txt
    -r{toxinidir}/requirements-test.txt
    -r{toxinidir}/requirements-docs.txt
commands =
    python -c "print('Development environment ready. Use: pytest, black, ruff, mypy, sphinx-build')"

[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -v --tb=short

[coverage:run]
source = src/planar_geometry
branch = true
parallel = true

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
precision = 2

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = .git,__pycache__,build,dist,.venv,venv,.tox

[mypy]
python_version = 3.10
strict = true
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
disallow_untyped_decorators = true

[isort]
profile = black
line_length = 88
multi_line_mode = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
